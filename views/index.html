<!DOCTYPE html>
<html>
<head>
	<title>Mini Blog</title>
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<style type="text/css">
		.mynav{
			padding-top: 120px;
			background-color: #CCFFFF;
		}
	</style>
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-2 affix mynav">
				<h2 style="text-align: center; color: green; padding-bottom: 50px;">Mini Blog</h2>
				<div style="width: 50%; margin: 0 auto;">
					<a id="uimg"><img src="images/Fruit-1.png" width="100%" style="border-radius:50%;"></a>
				</div>
				<br />
				<p style="text-align: center" id="uname">Username</p>
				<br />

				<ul class="nav nav-pills nav-stacked" role="tablist" style="text-align: center" id="mytab">
				  <li role="presentation" class="active"><a href="#blogs" role="tab" data-toggle="pill" id="blogs-tab">Blogs</a></li>
				  <li role="presentation"><a href="#following" role="tab" data-toggle="pill" id="following-tab">Following</a></li>
				  <li role="presentation"><a href="#follower" role="tab" data-toggle="pill" id="follower-tab">Follower</a></li>
				  <li role="presentation"><a href="#hall" role="tab" data-toggle="pill" id="hall-tab">Hall</a></li>
				  <li role="presentation"><a href="#logout" role="tab" data-toggle="pill">Log out</a></li>
				</ul>
			</div>
			<div class="col-md-offset-2 col-md-10 mymain" style="background-color: #99CCFF;">
				<div class="tab-content">
				  <div role="tabpanel" class="tab-pane active" id="blogs">
				  	<div class="bloglist row" style="padding-top: 100px; padding-bottom: 150px;">
				  		
				  	</div>
				  </div>
				  <div role="tabpanel" class="tab-pane" id="following">
				  	<div class="followinglist row" style="padding-top: 100px; padding-bottom: 150px;">
				  	</div>
				  </div>
				  <div role="tabpanel" class="tab-pane" id="follower">
				  	<div class="follower-list row" style="padding-top: 100px; padding-bottom: 150px;">
				  		<div class="media col-md-offset-2 col-md-6" style="background-color: #FFFFFF; padding-top: 10px; padding-bottom: 10px;">
						  <a class="media-left media-middle" href="#">
						    <img src="images/Fruit-1.png" width="48px" height="48px" style="border-radius:50%;">
						  </a>
						  <div class="media-body" style="width: 100%">
						    <h4>Username<span><button type="button" class="btn btn-success" style="float: right">Follow</button></span></4>
						  </div>
						</div>
						<div class="media col-md-offset-2 col-md-6" style="background-color: #FFFFFF; padding-top: 10px; padding-bottom: 10px;">
						  <a class="media-left media-middle" href="#">
						    <img src="images/Fruit-1.png" width="48px" height="48px" style="border-radius:50%;">
						  </a>
						  <div class="media-body" style="width: 100%">
						    <h4>Username<span><button type="button" class="btn btn-success" style="float: right">Follow</button></span></4>
						  </div>
						</div>
						<div class="media col-md-offset-2 col-md-6" style="background-color: #FFFFFF; padding-top: 10px; padding-bottom: 10px;">
						  <a class="media-left media-middle" href="#">
						    <img src="images/Fruit-1.png" width="48px" height="48px" style="border-radius:50%;">
						  </a>
						  <div class="media-body" style="width: 100%">
						    <h4>Username<span><button type="button" class="btn btn-success" style="float: right">Follow</button></span></4>
						  </div>
						</div>
						<div class="media col-md-offset-2 col-md-6" style="background-color: #FFFFFF; padding-top: 10px; padding-bottom: 10px;">
						  <a class="media-left media-middle" href="#">
						    <img src="images/Fruit-1.png" width="48px" height="48px" style="border-radius:50%;">
						  </a>
						  <div class="media-body" style="width: 100%">
						    <h4>Username<span><button type="button" class="btn btn-success" style="float: right">Follow</button></span></4>
						  </div>
						</div>
				  	</div>
				  </div>
				  <div role="tabpanel" class="tab-pane" id="hall">
				  	<div class="halllist row" style="padding-top: 100px; padding-bottom: 150px;">
				  	</div>
				  </div>
				  <div role="tabpanel" class="tab-pane" id="logout">logout</div>
				</div>
			</div>
		</div>
	</div>
	<script src="/js/jquery.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
	<script type="text/javascript">
		var height = $(window).height();
		$(".mynav").height(height);
		$(".mymain").css("min-height", height);
		var uid;
		var name;
		$(document).ready(function(){
				$.ajax({
					url: "/json",
					type: 'GET',
					dataType: 'json',
					success: function(data){
						// console.log(data);
						uid = parseInt(data.user.NodeIdentity);
						name = data.user.Properties.name;
						$("#uimg img").attr('src', "images/Fruit-" + (uid%20 + 1) + ".png");
						$("#uname").html(name);
					}
				});
				loadMoments();
			}
		);

        $('#blogs-tab').click(function (e) {
  			console.log("blogs");
  			loadMoments();
 			$('#myTab a[href="#blogs-tab"]').tab('show');
		});
		$('#following-tab').click(function (e) {
  			console.log("following!");
  			loadFollowing();
  			$('#myTab a[href="#following-tab"]').tab('show');
		});
		$('#follower-tab').click(function (e) {
  			console.log("follower!");
  			$('#myTab a[href="#follower-tab"]').tab('show');
		});
		$('#hall-tab').click(function (e) {
  			console.log("hall");
  			loadHall();
  			$('#myTab a[href="#hall-tab"]').tab('show');
		});
		function loadMoments(){
			$('.bloglist').html("");
			$.ajax({
  				url:'/moment',
			    type:'GET', //GET
			    dataType: 'json',
			    success: function(data){
			    	// console.log(data);
			    	$.each(data, function(i, item){
			    		// console.log(item);
			    		var content = '<div class="media col-md-offset-2 col-md-6" style="background-color: #FFFFFF; padding-top: 20px;"><a class="media-left media-top" href="#"><img src="images/Fruit-'+(parseInt(item.friend.NodeIdentity)%2 + 1)+'.png" width="64px" height="64px" style="border-radius:50%;"></a><div class="media-body" style="width: 100%"><h4 class="media-heading" id="'+item.friend.Properties.name+'">Username</h4><p>'+item.moment.Properties.time+'</p><p style="background-color: #f5f5f5; width: 100%; padding: 14px 20px;">'+item.moment.Properties.content+'</p></div></div>';
			    		$(".bloglist").append(content);
			    	});
			    }
  			});
		}
		function loadFollowing(){
			$(".followinglist").html("");
			$.ajax({
  				url:'/user/following?id='+uid,
			    type:'GET', //GET
			    dataType: 'json',
			    success: function(data){
			    	console.log(data);
			    	$.each(data, function(i, item){
			    		// console.log(item);
			    		var content = '<div class="media col-md-offset-2 col-md-6" style="background-color: #FFFFFF; padding-top: 10px; padding-bottom: 10px;"><a class="media-left media-middle" href="#"><img src="images/Fruit-'+item.html+'.png" width="48px" height="48px" style="border-radius:50%;"></a><div class="media-body" style="width: 100%"><h4>Username<span><button type="button" class="btn btn-danger" style="float: right">Unfollow</button></span></4></div></div>';
			    		$(".followinglist").append(content);
			    	});
			    }
  			});
		}
		function loadHall(){
			$(".halllist").html("");
			$.ajax({
  				url:'/admin/user',
			    type:'GET', //GET
			    dataType: 'json',
			    success: function(data){
			    	console.log(data);
			    	$.each(data, function(i, item){
			    		// console.log(item);
			    		var content = '<div class="media col-md-offset-4 col-md-4" style="background-color: #FFFFFF; padding-top: 10px; padding-bottom: 10px;"><a class="media-left media-middle" href="/user?id='+item.NodeIdentity+'"><img src="images/Fruit-'+(parseInt(item.NodeIdentity)%2 + 1)+'.png" width="48px" height="48px" style="border-radius:50%;"></a><div class="media-body" style="width: 100%"><h4>'+item.Properties.name+'</h4></div></div>';
			    		$(".halllist").append(content);
			    	});
			    }
  			});
		}
	</script>
</body>
</html>
